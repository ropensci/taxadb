<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial for taxadb • taxadb</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial for taxadb">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">taxadb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/articles/schema.html">Database schema for taxadb</a>
    </li>
    <li>
      <a href="../articles/intro.html">Tutorial for taxadb</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cboettig/taxadb">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tutorial for taxadb</h1>
                        <h4 class="author">Carl Boettiger</h4>
            
            <h4 class="date">2019-03-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cboettig/taxadb/blob/master/vignettes/intro.Rmd"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<p>Here we illustrate the use of <code>taxadb</code> to resolve names in the Breeding Bird Survey species list more completely.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(readr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(taxadb)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/td_create.html">td_create</a></span>(<span class="st">"all"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">bbs &lt;-<span class="st"> </span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/bbs.tsv"</span>, <span class="dt">package=</span><span class="st">"taxadb"</span>))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(bbs)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; [1] 750   9</span></a></code></pre></div>
<p>Outline strategy for name resolution.</p>
<p>ID resolution including synonym mapping.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">bbs_ids &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">bbs <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">         <span class="dt">gbif =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"gbif"</span>),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">          <span class="dt">col =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"col"</span> ),</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">         <span class="dt">itis =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"itis"</span>),</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">         <span class="dt">ncbi =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"ncbi"</span>),</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">           <span class="dt">wd =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"wd"</span>  ),</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">         <span class="dt">iucn =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"iucn"</span>),</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">          <span class="dt">ott =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"ott"</span> ) </a>
<a class="sourceLine" id="cb4-12" data-line-number="12">  )</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">bbs_ids <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>species) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(<span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(x)))</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; gbif  col itis ncbi   wd iucn  ott </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;  306  587  656  184  630  643  665</span></a></code></pre></div>
<p><code>get_ids</code> looks only for exact matches. Certain names may not uniquely resolve to a single ID, such as a name which is a recognized synonym for two separate taxonomic groups (such as may happen if a species is split.)</p>
<p>We can get more matches by cleaning the names first. The <code><a href="../reference/clean_names.html">clean_names()</a></code> function provides several simple string manipulations to tidy names to improve the probability of a match: missing species (specific eptithets) such as <code>Accipiter sp.</code> drop the <code>sp.</code>, allowing matches against Genus names, and intraspecific epithets such as <code>Colaptes auratus cafer</code> are dropped to binomial names, <code>Colaptes auratus</code>. These transformations may not be appropriate for certain use cases, and should be used with care.</p>
<p>Observe that truncating names would result in a handful of subspecies being resolved only to the species level identifiers:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">bbs_cleaned_ids &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span>bbs_ids <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(species, ott) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">ids_post_clean =</span> </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">           <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(<span class="kw"><a href="../reference/clean_names.html">clean_names</a></span>(species, <span class="dt">binomial_only =</span> <span class="ot">TRUE</span>), </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                   <span class="st">"ott"</span>, <span class="st">"prefix"</span>))</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">bbs_cleaned_ids <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(ott <span class="op">!=</span><span class="st"> </span>ids_post_clean)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;   species                            ott         ids_post_clean</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;   &lt;chr&gt;                              &lt;chr&gt;       &lt;chr&gt;         </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; 1 Branta bernicla nigricans          OTT:799107  OTT:135287    </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; 2 Anas platyrhynchos diazi           OTT:82410   OTT:765167    </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; 3 Buteo jamaicensis harlani          OTT:1070094 OTT:509839    </span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; 4 Vermivora chrysoptera x cyanoptera OTT:6153649 OTT:85249     </span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; 5 Setophaga coronata coronata        OTT:349904  OTT:451168    </span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; 6 Passerina amoena x cyanea          OTT:4947623 OTT:119888</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17">x &lt;-<span class="st"> </span>bbs_cleaned_ids <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(ott <span class="op">!=</span><span class="st"> </span>ids_post_clean)  </a>
<a class="sourceLine" id="cb6-18" data-line-number="18"></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">x</a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="co">#&gt;   species                            ott         ids_post_clean</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt;   &lt;chr&gt;                              &lt;chr&gt;       &lt;chr&gt;         </span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co">#&gt; 1 Branta bernicla nigricans          OTT:799107  OTT:135287    </span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="co">#&gt; 2 Anas platyrhynchos diazi           OTT:82410   OTT:765167    </span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="co">#&gt; 3 Buteo jamaicensis harlani          OTT:1070094 OTT:509839    </span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="co">#&gt; 4 Vermivora chrysoptera x cyanoptera OTT:6153649 OTT:85249     </span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="co">#&gt; 5 Setophaga coronata coronata        OTT:349904  OTT:451168    </span></a>
<a class="sourceLine" id="cb6-28" data-line-number="28"><span class="co">#&gt; 6 Passerina amoena x cyanea          OTT:4947623 OTT:119888</span></a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="kw"><a href="../reference/by_id.html">by_id</a></span>(x<span class="op">$</span>ids_post_clean, <span class="dt">provider =</span> <span class="st">"ott"</span>)</a>
<a class="sourceLine" id="cb6-30" data-line-number="30"><span class="co">#&gt; # A tibble: 6 x 15</span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="co">#&gt;   taxonID scientificName taxonRank acceptedNameUsa… taxonomicStatus kingdom</span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;           &lt;chr&gt;  </span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="co">#&gt; 1 OTT:13… Branta bernic… species   OTT:135287       accepted        Metazoa</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="co">#&gt; 2 OTT:76… Anas platyrhy… species   OTT:765167       accepted        Metazoa</span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35"><span class="co">#&gt; 3 OTT:50… Buteo jamaice… species   OTT:509839       accepted        Metazoa</span></a>
<a class="sourceLine" id="cb6-36" data-line-number="36"><span class="co">#&gt; 4 OTT:85… Vermivora chr… species   OTT:85249        accepted        Metazoa</span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37"><span class="co">#&gt; 5 OTT:45… Setophaga cor… species   OTT:451168       accepted        Metazoa</span></a>
<a class="sourceLine" id="cb6-38" data-line-number="38"><span class="co">#&gt; 6 OTT:11… Passerina amo… species   OTT:119888       accepted        Metazoa</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39"><span class="co">#&gt; # … with 9 more variables: phylum &lt;chr&gt;, class &lt;chr&gt;, order &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40"><span class="co">#&gt; #   family &lt;chr&gt;, genus &lt;chr&gt;, specificEpithet &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41"><span class="co">#&gt; #   infraspecificEpithet &lt;chr&gt;, input &lt;chr&gt;, sort &lt;int&gt;</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">bbs_cleaned_ids <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(ott) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(ids_post_clean))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; # A tibble: 75 x 3</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;    species                                     ott   ids_post_clean</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;                                       &lt;chr&gt; &lt;chr&gt;         </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  1 Chen caerulescens (blue form)               &lt;NA&gt;  OTT:190878    </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;  2 Anas platyrhynchos x rubripes or fulvigula  &lt;NA&gt;  OTT:765167    </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  3 Aythya marila / affinis                     &lt;NA&gt;  OTT:1044561   </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  4 Melanitta perspicillata / fusca / americana &lt;NA&gt;  OTT:972536    </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  5 Bucephala clangula / islandica              &lt;NA&gt;  OTT:166683    </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  6 Dendragapus obscurus / fuliginosus          &lt;NA&gt;  OTT:1003843   </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  7 Aechmophorus occidentalis / clarkii         &lt;NA&gt;  OTT:758343    </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  8 Coccyzus americanus / erythropthalmus       &lt;NA&gt;  OTT:891425    </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  9 Chordeiles acutipennis / minor              &lt;NA&gt;  OTT:484902    </span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; 10 Chordeiles minor / gundlachii               &lt;NA&gt;  OTT:870594    </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; # … with 65 more rows</span></a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">pick &lt;-<span class="st"> </span><span class="cf">function</span>(A, B){ A[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(A)] &lt;-<span class="st"> </span>B[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(A)]; A }</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">ott_ids &lt;-<span class="st"> </span>bbs_cleaned_ids <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">ids =</span> <span class="kw">pick</span>(ott, ids_post_clean))</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">unmatched &lt;-<span class="st"> </span>ott_ids <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(ids)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(species, ids) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">species =</span> <span class="kw"><a href="../reference/clean_names.html">clean_names</a></span>(species))</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">unmatched</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; # A tibble: 10 x 2</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;    species               ids  </span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;    &lt;chr&gt;                 &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;  1 spatula cyanoptera    &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;  2 antrostomus vociferus &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt;  3 antrostomus arizonae  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;  4 trochilid             &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;  5 antigone canadensis   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;  6 gull                  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt;  7 tern                  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt;  8 ardeid                &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt;  9 woodpecker            &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt; 10 icterus townsendi     &lt;NA&gt;</span></a></code></pre></div>
<p>Of the remaining 10 names, 3 are clearly common names (<code>gull</code>, <code>tern</code>, <code>woodpecker</code>), two (<code>trochilid</code> and <code>ardeid</code>) are references to family names, <em>Trochilidae</em> and <em>Ardeidae</em>, and the remaining five are unresolved.</p>
<p>We can confirm that the two family names can be resolved:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Trochilidae"</span>,  <span class="st">"Ardeidae"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/by_name.html">by_name</a></span>(<span class="st">"ott"</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; # A tibble: 2 x 15</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt;   taxonID scientificName taxonRank acceptedNameUsa… taxonomicStatus kingdom</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;           &lt;chr&gt;  </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; 1 OTT:81… Trochilidae    family    OTT:810751       accepted        &lt;NA&gt;   </span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; 2 OTT:60… Ardeidae       family    OTT:609781       accepted        &lt;NA&gt;   </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; # … with 9 more variables: phylum &lt;chr&gt;, class &lt;chr&gt;, order &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; #   family &lt;chr&gt;, genus &lt;chr&gt;, specificEpithet &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; #   infraspecificEpithet &lt;chr&gt;, input &lt;chr&gt;, sort &lt;int&gt;</span></a></code></pre></div>
<p>We can also use the <code>vernacularName</code> field available in some naming providers to resolve common names:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/by_rank.html">by_rank</a></span>(<span class="st">"Aves"</span>, <span class="st">"class"</span>, <span class="st">"col"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"Woodpecker"</span>, vernacularName)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(vernacularName, scientificName, acceptedNameUsageID)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; # A tibble: 161 x 3</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt;    vernacularName            scientificName             acceptedNameUsageID</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt;    &lt;chr&gt;                     &lt;chr&gt;                      &lt;chr&gt;              </span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;  1 Pileated Woodpecker       Dryocopus pileatus         COL:35519707       </span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;  2 Red-headed Woodpecker     Melanerpes erythrocephalus COL:35519725       </span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;  3 Acorn Woodpecker          Melanerpes formicivorus    COL:35519728       </span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;  4 Golden-fronted Woodpecker Melanerpes aurifrons       COL:35519733       </span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;  5 Red-bellied Woodpecker    Melanerpes carolinus       COL:35519734       </span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;  6 Lewis's Woodpecker        Melanerpes lewis           COL:35519735       </span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;  7 Puerto Rican Woodpecker   Melanerpes portoricensis   COL:35519736       </span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt;  8 Gila Woodpecker           Melanerpes uropygialis     COL:35519737       </span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt;  9 Black-backed Woodpecker   Picoides arcticus          COL:35519785       </span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; 10 Three-toed Woodpecker     Picoides tridactylus       COL:35519786       </span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt; # … with 151 more rows</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#by_common(c("Woodpecker"), "col")</span></a></code></pre></div>
<p>Let us attempt to resolve the remaining five names.</p>
<p>Consulting IUCN Redlist names, we can resolve acceptedNameUsageIDs for four of these five:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">unmatched <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">" "</span>, species)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">iucn =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(species, <span class="st">"iucn"</span>, <span class="st">"prefix"</span>))</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; # A tibble: 5 x 3</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt;   species               ids   iucn         </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt; &lt;chr&gt;        </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; 1 spatula cyanoptera    &lt;NA&gt;  IUCN:22680233</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; 2 antrostomus vociferus &lt;NA&gt;  IUCN:22736393</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; 3 antrostomus arizonae  &lt;NA&gt;  IUCN:22736398</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; 4 antigone canadensis   &lt;NA&gt;  IUCN:22692078</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; 5 icterus townsendi     &lt;NA&gt;  &lt;NA&gt;</span></a></code></pre></div>
<p>By consulting the synonyms table, we can quickly see what other names these species might be known by:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">syn &lt;-<span class="st"> </span>unmatched<span class="op">$</span>species <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/synonyms.html">synonyms</a></span>(<span class="st">"iucn"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>()</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">syn</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt;   acceptedNameUsage     synonym               taxonRank</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;                 &lt;chr&gt;    </span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; 1 Spatula cyanoptera    Anas cyanoptera       species  </span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; 2 Antrostomus vociferus Caprimulgus vociferus species  </span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt; 3 Antrostomus arizonae  Caprimulgus vociferus species  </span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; 4 Antrostomus arizonae  Caprimulgus arizonae  species  </span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt; 5 &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;     </span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt; 6 Antigone canadensis   Grus canadensis       species</span></a></code></pre></div>
<p>Note that three of the four synonyms given by IUCN are considered accepted names in OTT:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">syn <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">IUCN_name =</span> acceptedNameUsage,</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">         <span class="dt">OTT_name =</span> synonym) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">ott_id =</span>  <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(OTT_name, <span class="st">"ott"</span>),</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">         <span class="dt">iucn_id =</span> <span class="kw"><a href="../reference/get_ids.html">get_ids</a></span>(IUCN_name, <span class="st">"iucn"</span>))</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt;   IUCN_name           OTT_name            taxonRank ott_id     iucn_id     </span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;               &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;       </span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; 1 Spatula cyanoptera  Anas cyanoptera     species   OTT:82411  IUCN:226802…</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; 2 Antrostomus vocife… Caprimulgus vocife… species   OTT:10395… IUCN:227363…</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; 3 Antrostomus arizon… Caprimulgus vocife… species   OTT:10395… IUCN:227363…</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; 4 Antrostomus arizon… Caprimulgus arizon… species   &lt;NA&gt;       IUCN:227363…</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; 5 &lt;NA&gt;                &lt;NA&gt;                &lt;NA&gt;      &lt;NA&gt;       &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; 6 Antigone canadensis Grus canadensis     species   OTT:257929 IUCN:226920…</span></a></code></pre></div>
<p>We cannot simply assume that we can crosswalk synonyms between different providers, as providers may be operating on different taxonomic concepts. In this example, IUCN recognizes four distinct taxa while OTT recognizes only thee.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carl Boettiger, Kari Norman, Jorrit Poelen, Scott Chamberlain.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
